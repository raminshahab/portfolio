<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chewse Tech Interview</title>
 
  <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.6.0.css">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/qunit/qunit-2.6.0.js"></script>
 
  <script>
          /**
           * Get Meal Ratios - distributes meal ratios based on portions size 
           * @param object map
           * @param int portions
           * @ret object ratios
           * @author Ramin Shahab
           */

           function getMealRatios(map, portions) {
                // Base Case: 
                // Choose largest integer for non-integer portion counts 
                // When map is empty return empty {}
                // When portions are empty set every key's value to 0 and return {}
                var numKeys = Object.keys(map).length;
                var sqrtPortions = Math.floor(Math.sqrt(portions));
                var dividedPortions = new Array(numKeys);
                var portionsObj = {};

                if ($.isEmptyObject(map)) {
                    console.log("map is empty");
                    return {};
                }

                if ($.isNumeric(portions)) {
                    portions = Math.ceil(portions);
                } else {
                    // case if given a non-numeric value
                    portions = 0;
                }

                // divide the array into equal parts to start 
                var parts = Math.floor((portions / numKeys));

                // fill the portions array with divided portions
                dividedPortions.fill(parts, 0, numKeys);

                for (var i = 0; i < dividedPortions.length; i++) {
                    // set the sum of array values 
                    var sum = dividedPortions.reduce(getSum);
                    // break loop once we find the sum equaling portions
                    if (sum == portions) {

                        break;

                    } else if (sum > portions) {

                        break;

                    } else {

                        dividedPortions[i] += 1;
                    }
                }
                    // package back into original data type
                $.each(dividedPortions, function(index, value) {
                    //console.log("div index " + dividedPortions[index]);
                    portionsObj[index+1] = dividedPortions[index];

                });

                 // helper method to calculate the sum of array 
                function getSum(total, num) {
                    return total + num;
                }

                return portionsObj;

            }

            // call method
            var $ratio = getMealRatios({
                1: 2,
                2: 4,
                3: 5
            }, 5);
            
            console.log($ratio);

   /**
    * Qunit Test Case 
    * @param object map
    * @param int portions
    *  
    */

  QUnit.test('getMealRatios', function( assert ) {
    assert.deepEqual(getMealRatios({1:2,2:4,3:5}, 5), {1: 2, 2:2, 3: 1});
    assert.deepEqual(getMealRatios({1:1}, 2), {1:2});
    assert.deepEqual(getMealRatios({1: 1}, 0), {1: 0});
    assert.deepEqual(getMealRatios({1: 1, 2:1, 3:1},  11), {1: 4, 2: 4, 3: 3});
  });
  </script>
</head>
<body>
 
<div id="qunit"></div>
 
</body>
</html>